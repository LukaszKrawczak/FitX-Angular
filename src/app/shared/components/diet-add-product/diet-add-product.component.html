<div class="row mt-10">

  <table
    *ngIf="dailyProducts$.length > 0"
    class="table table-condensed"
  >
    <thead></thead>
    <tbody >
    <tr *ngFor="let product of dailyProducts$; let i = index">
      <th class="text-left">{{product.name}}</th>
      <th class="text-right">{{product.nutrition.kcal | number: '1.0-0'}}</th>
      <th class="text-right"><a type="button" (click)="removeMeal(i)">X</a></th>
    </tr>
    </tbody>
    <tfoot>
    <tr>
      <th class="text-left">
        P: {{_dietCalc.totalProteins | number: '1.0-0'}}
        C: {{_dietCalc.totalCarbs | number: '1.0-0'}}
        T: {{_dietCalc.totalFats | number: '1.0-0'}}</th>
      <th class="text-right">{{_dietCalc.totalCalories | number:'1.0-0'}} kcal</th>
      <th></th>
    </tr>
    </tfoot>

  </table>
</div>
<a
    #addProductButtonElement
    class="btn btn-primary"
    [ngClass]="(addProductButtonElement.hidden) ? 'hidden' : 'visible'"
    (click)="addProductButtonElement.hidden = true"
>
  Dodaj posiłek
</a>

<div *ngIf="!addProductButtonElement.hidden; else newProduct"></div>

<ng-template #newProduct>

  <form #form="ngForm">

    <div class="row mt-10">

      <div class="input-group">
        <input
            #query
            (keyup)="keyUp.next(query.value)"
            [(ngModel)]="searchedProduct"
            placeholder="Wpisz nazwę produktu"
            autocomplete="off"
            class="form-control"
            name="name" id="name" type="text" maxlength="100">
        <span class="input-group-btn">
          <button class="btn btn-danger" *ngIf="addProductButtonElement.hidden"
                  (click)="addProductButtonElement.hidden = false">X</button>
        </span>
      </div>
    </div>
    <div *ngFor="let product of filteredProducts$">
      <li>{{product.name}}
        <a
            #addProductWeightButtonElement
            class="btn btn-sm"
            [ngClass]="(addProductWeightButtonElement.hidden) ? 'hidden' : 'visible'"
            (click)="addProductWeightButtonElement.hidden = true"
        >
          Dodaj
        </a>
      </li>
      <div *ngIf="addProductWeightButtonElement.hidden">
        <ng-container [ngTemplateOutlet]="addWeight"
                      [ngTemplateOutletContext]="{product:product}"></ng-container>
      </div>
    </div>

  </form>

</ng-template>

<ng-template #addWeight let-product="product">

  <div class="input-group">
    <input
        #weight
        (keyup)="setProductWeight(weight.value)"
        autocomplete="off"
        class="form-control"
        name="weight" id="weight" type="number">

    <span class="input-group-btn">
  <button
    class="btn btn-success"
    type="button"
    (click)="addProductButtonElement.hidden = false;
    addProductToList(product, weight.value);
    "
  >
    OK
  </button>
    </span>
  </div>

</ng-template>
